#!/bin/bash
# file to setup documentation building pipeline without docker
# $1 : Path to the doc-builder folder relative to the ivy/docs folder

# install libraries for the doc-builder
cat $1/requirements.txt | xargs -n 1 pip install;

# install libraries for ivy
pip install -r ../requirements/requirements.txt || exit 1
pip install torch==1.11.0
pip install torch-scatter==2.0.9
pip install -r ../requirements/optional.txt || exit 1

# syncing ivy folder with the doc-builder folder
rsync -rav $1/docs/ . || exit 1

# Delete any previously generated content
rm -r -f autogenerated_source

# delete any previously generated pages
rm -r -f build

# generate content
sudo python3 generate_src_rst_files.py  --root_dir ../ivy || exit 1

# generate pages from content
sudo python3 sphinx-build.py -Q -b html autogenerated_source build || exit 1

python3 correct_built_html_files.py || exit 1

# delete the code
bash remove_files.sh
rm -r -f remove_files.sh
