# Workflow to run all the tests for the ivy frontends and functional api,
# and update the test dashboard with the results

name: update-test-dashboard
on:
  workflow_dispatch:
  schedule:
    - cron: "0 0 * * 0"
  push:
permissions:
  actions: read
jobs:
  update-frontends-torch:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️Ivy
        uses: actions/checkout@v3
        with:
          path: ivy
          persist-credentials: false

      - name: Install ivy
        run: |
          cd ivy
          sudo pip3 install -e .

      - name: Run Tests
        id: tests
        run: |
          exit_code=2
          cd ivy
          pip3 install pymongo
          pip3 install pytest-json-report
          docker run --rm -v "$(pwd)":/ivy -v "$(pwd)"/.hypothesis:/.hypothesis unifyai/ivy:latest scripts/update_test_dashboard/update_torch_frontends.sh
          exit_code=$?
          echo "exit_code=$exit_code" >> $GITHUB_ENV
        continue-on-error: true

      - name: Check on failures
        if: steps.tests.outcome != 'success'
        run: |
          if [[ "$exit_code" -eq 0 || "$exit_code" -eq 1 ]]; then
            exit 0
          else
            exit 1
          fi

  update-frontends-tensorflow:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️Ivy
        uses: actions/checkout@v3
        with:
          path: ivy
          persist-credentials: false

      - name: Install ivy
        run: |
          cd ivy
          sudo pip3 install -e .

      - name: Run Tests
        id: tests
        run: |
          cd ivy
          pip3 install pymongo
          pip3 install pytest-json-report
          docker run --rm -v "$(pwd)":/ivy -v "$(pwd)"/.hypothesis:/.hypothesis unifyai/ivy:latest scripts/update_test_dashboard/update_tensorflow_frontends.sh

  update-frontends-jax:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️Ivy
        uses: actions/checkout@v3
        with:
          path: ivy
          persist-credentials: false

      - name: Install ivy
        run: |
          cd ivy
          sudo pip3 install -e .

      - name: Run Tests
        id: tests
        run: |
          cd ivy
          pip3 install pymongo
          pip3 install pytest-json-report
          docker run --rm -v "$(pwd)":/ivy -v "$(pwd)"/.hypothesis:/.hypothesis unifyai/ivy:latest scripts/update_test_dashboard/update_jax_frontends.sh

  update-frontends-numpy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️Ivy
        uses: actions/checkout@v3
        with:
          path: ivy
          persist-credentials: false

      - name: Install ivy
        run: |
          cd ivy
          sudo pip3 install -e .

      - name: Run Tests
        id: tests
        run: |
          cd ivy
          pip3 install pymongo
          pip3 install pytest-json-report
          docker run --rm -v "$(pwd)":/ivy -v "$(pwd)"/.hypothesis:/.hypothesis unifyai/ivy:latest scripts/update_test_dashboard/update_numpy_frontends.sh

  update-frontends-paddle:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️Ivy
        uses: actions/checkout@v3
        with:
          path: ivy
          persist-credentials: false

      - name: Install ivy
        run: |
          cd ivy
          sudo pip3 install -e .

      - name: Run Tests
        id: tests
        run: |
          cd ivy
          pip3 install pymongo
          pip3 install pytest-json-report
          docker run --rm -v "$(pwd)":/ivy -v "$(pwd)"/.hypothesis:/.hypothesis unifyai/ivy:latest scripts/update_test_dashboard/update_paddle_frontends.sh
        
  update-ivy-core:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️Ivy
        uses: actions/checkout@v3
        with:
          path: ivy
          persist-credentials: false

      - name: Install ivy
        run: |
          cd ivy
          sudo pip3 install -e .

      - name: Run Tests
        id: tests
        run: |
          cd ivy
          pip3 install pymongo
          pip3 install pytest-json-report
          docker run --rm -v "$(pwd)":/ivy -v "$(pwd)"/.hypothesis:/.hypothesis unifyai/ivy:latest scripts/update_test_dashboard/update_ivy_core.sh
    
  update-ivy-experimental-core:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️Ivy
        uses: actions/checkout@v3
        with:
          path: ivy
          persist-credentials: false

      - name: Install ivy
        run: |
          cd ivy
          sudo pip3 install -e .

      - name: Run Tests
        id: tests
        run: |
          cd ivy
          pip3 install pymongo
          pip3 install pytest-json-report
          docker run --rm -v "$(pwd)":/ivy -v "$(pwd)"/.hypothesis:/.hypothesis unifyai/ivy:latest scripts/update_test_dashboard/update_ivy_experimental_core.sh

  update-ivy-experimental-nn:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️Ivy
        uses: actions/checkout@v3
        with:
          path: ivy
          persist-credentials: false

      - name: Install ivy
        run: |
          cd ivy
          sudo pip3 install -e .

      - name: Run Tests
        id: tests
        run: |
          cd ivy
          pip3 install pymongo
          pip3 install pytest-json-report
          docker run --rm -v "$(pwd)":/ivy -v "$(pwd)"/.hypothesis:/.hypothesis unifyai/ivy:latest scripts/update_test_dashboard/update_ivy_experimental_nn.sh

  update-ivy-nn:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️Ivy
        uses: actions/checkout@v3
        with:
          path: ivy
          persist-credentials: false

      - name: Install ivy
        run: |
          cd ivy
          sudo pip3 install -e .

      - name: Run Tests
        id: tests
        run: |
          cd ivy
          pip3 install pymongo
          pip3 install pytest-json-report
          docker run --rm -v "$(pwd)":/ivy -v "$(pwd)"/.hypothesis:/.hypothesis unifyai/ivy:latest scripts/update_test_dashboard/update_ivy_nn.sh
